graph TD
    subgraph "Phase 1: Macro-Decomposition & Normalization"
        A[Input Time Series <br> [B, L, C]] --> B(RevIN Norm);
        B --> C{Series Decomp};
        C --> D[Trend Component <br> `trend_init`];
        C --> E[Seasonal Component <br> `seasonal_init`];
    end

    subgraph "Phase 2: Parallel Expert Branches"
        subgraph "Branch A: Trend Forecasting"
            D --> F[FastKAN];
            F --> G((Trend Prediction <br> `trend_output`));
        end

        subgraph "Branch B: Seasonal Forecasting (ChronoWave-Pyramid)"
            E --> H{DWT};
            H --> I[Low-Freq Coeff. `cA`];
            H --> J[High-Freq Coeffs. `cD_k`];
            
            subgraph "Coefficient Prediction"
                direction LR
                I --> K[MLP Mixer];
                J --> L[TCN Mixers];
            end

            subgraph "Pyramid Fusion"
                K --> M[Initial `cA` Pred];
                L --> N[Initial `cD_k` Preds];
                M & N --> O{Feature Pyramid <br> Top-Down Refinement};
                O --> P((Refined Seasonal Pred <br> `seasonal_output`));
            end
            
            subgraph "Reconstruction"
                P -- IDWT --> Q[Seasonal Time Series];
            end
        end

        subgraph "Branch C: High-Frequency Shortcut"
            E --> R[Linear Layer];
            R --> S((HF Correction <br> `high_freq_correction`));
        end
    end

    subgraph "Phase 3: Final Aggregation"
        G & Q & S --> T(Aggregation <br> Summation);
        T --> U(RevIN Denorm);
        U --> V[Final Forecast <br> [B, T, C]];
    end

    %% Styling for clarity and aesthetics
    style A fill:#e3f2fd,stroke:#3f51b5,stroke-width:2px
    style V fill:#e3f2fd,stroke:#3f51b5,stroke-width:2px
    style C fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style H fill:#dcedc8,stroke:#33691e,stroke-width:2px
    style O fill:#dcedc8,stroke:#33691e,stroke-width:2px
    style F fill:#ffe0b2,stroke:#ef6c00,stroke-width:2px
    style L fill:#ffe0b2,stroke:#ef6c00,stroke-width:2px
    style T fill:#fce4ec,stroke:#ad1457,stroke-width:2px```